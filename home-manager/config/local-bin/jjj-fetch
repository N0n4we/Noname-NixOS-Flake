#!/usr/bin/env bash
set -euo pipefail

target_dir="${1:-.}"

for dir in "$target_dir"/*; do
    if [ -d "$dir" ] && [ -d "$dir/.jj" ]; then
        output=$(cd "$dir" && jj git fetch 2>&1) || true
        if [[ "$output" != "Nothing changed." ]]; then
            clean_name=$(basename "$dir")
            echo -e "\n\033[1;33m=== $clean_name ===\033[0m"
            echo "$output"
        fi
    fi
done
echo ""
